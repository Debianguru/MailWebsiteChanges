<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Mailwebsitechanges by Debianguru</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Mailwebsitechanges</h1>
        <h2>Python script to keep track of website updates; sends email notifications and provides RSS2 feed</h2>

        <section id="downloads">
          <a href="https://github.com/Debianguru/MailWebsiteChanges/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Debianguru/MailWebsiteChanges/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Debianguru/MailWebsiteChanges" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a name="mailwebsitechanges" class="anchor" href="#mailwebsitechanges"><span class="octicon octicon-link"></span></a>MailWebsiteChanges</h1>

<p>Python script to keep track of website changes; sends email notifications on updates and/or also provides an RSS feed</p>

<p>To specify which parts of a website should be monitored, <b>XPath selectors</b> (e.g. "//h1"), <b>CSS selectors</b> (e.g. "h1"), <b>and regular expressions can be used</b> (just choose the tools you like!).</p>

<p>MailWebsiteChanges is related to <a href="http://code.google.com/p/pagemon-chrome-ext/">PageMonitor</a> for Chrome and <a href="https://addons.mozilla.org/de/firefox/addon/alertbox/">AlertBox</a> / <a href="https://addons.mozilla.org/de/firefox/addon/check4change/">Check4Change</a> for Firefox. However, instead of living in your web browser, you can run it independently from command line / bash and install it as a simple cron job running on your linux server.</p>

<p><i>This is Open Source -- so please contribute eagerly! ;-)</i></p>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Configuration can be done by creating a <code>config.py</code> file (just place this file in the program folder):
Some examples:</p>

<h3>
<a name="website-definitions" class="anchor" href="#website-definitions"><span class="octicon octicon-link"></span></a>Website definitions</h3>

<pre>
<code>
sites = [

          {'shortname': 'mywebsite1',
           'uri': 'http://www.mywebsite1.com/info',
           'contentcss': 'div'},

          {'shortname': 'mywebsite2',
           'uri': 'http://www.mywebsite2.com/info',
           'contentxpath': '//*[contains(concat(\' \', normalize-space(@class), \' \'), \' news-list-container \')]',
           'titlexpath': '//title'},

          {'shortname': 'mywebsite3',
           'uri': 'http://www.mywebsite3.com/info',
           'type': 'text',
           'contentregex': 'Version\"\:\d*\.\d*'}

]
</code>
</pre>

<ul>
<li>
<p>parameters:</p>

<ul>
<li>
<b>shortname</b><br>
short name of the entry, used as an identifier when sending email notifications</li>
<li>
<b>uri</b><br>
URI of the website; If the scheme of the uri is 'cmd://', the string is interpreted as a command and the standard output (stdout) is parsed.</li>
<li>
<b>type</b> (optional; default: 'html')<br>
content type, e.g., 'xml'/'html'/'text'.</li>
<li>
<b>contentxpath</b> / <b>titlexpath</b> (optional)<br>
XPath expression for the content/title sections to extract. If you prefer, you could use contentcss/titlecss instead.</li>
<li>
<b>contentcss</b> / <b>titlecss</b> (optional)<br>
CSS expression for the content/title sections to extract. This is ignored if there is a corresponding XPath definition.</li>
<li>
<b>contentregex</b> / <b>titleregex</b> (optional)<br>
Regular expression. If XPath/CSS selector is defined, the regular expression is applied afterwards.</li>
<li>
<b>encoding</b> (optional; default: 'utf-8')<br>
Character encoding of the website, e.g., 'utf-8' or 'iso-8859-1'.</li>
</ul>
</li>
<li><p>We collect some XPath/CSS snippets at this place: <a href="https://github.com/Debianguru/MailWebsiteChanges/wiki/snippets">Snippet collection</a> - please feel free to add your own definitions!</p></li>
<li><p>The <b>--dry-run="shortname"</b> option might be useful in order to validate and fine-tune a definition.</p></li>
<li>
<p>If you would like to keep the data stored in a different place than the working directory, you can include something like this:</p>

<pre>
<code>
os.chdir('/path/to/data/directory')
</code>
</pre>
</li>
</ul><h3>
<a name="mail-settings" class="anchor" href="#mail-settings"><span class="octicon octicon-link"></span></a>Mail settings</h3>

<pre>
<code>
enableMailNotifications = True   #enable/disable notification messages; if set to False, only send error messages
subjectPostfix = 'A website has been updated!'

sender = 'me@mymail.com'
smtphost = 'mysmtpprovider.com'
useTLS = True
smtpport = 587
smtpusername = sender
smtppwd = 'mypassword'
receiver = 'me2@mymail.com'   # set to '' to also disable notifications in case of errors (not recommended)
</code>
</pre>

<h3>
<a name="rss-feeds" class="anchor" href="#rss-feeds"><span class="octicon octicon-link"></span></a>RSS Feeds</h3>

<p>If you prefer to use the RSS feature, you just have to specify the path of the feed file which should be generated by the script (e.g., rssfile = 'feed.xml') and then point your webserver to that file. You can also invoke the FeedServer.py script which implements a very basic webserver.</p>

<pre>
 <code>
enableRSSFeed = True   #enable/disable RSS feed

rssfile = 'feed.xml'
maxFeeds = 100
 </code>
</pre>

<h3>
<a name="program-execution" class="anchor" href="#program-execution"><span class="octicon octicon-link"></span></a>Program execution</h3>

<p>To setup a job that periodically runs the script, simply attach something like this to your /etc/crontab:</p>

<pre>
 <code>
0 8-22/2    * * *   root    /usr/bin/python3 /path/to/MailWebsiteChanges/MailWebsiteChanges.py
 </code>
</pre>

<p>This will run the script every two hours between 8am and 10pm.</p>

<p>If you prefer invoking the script with an alternate configuration files, simply pass the name of the configuration file as an argument, e.g., for <code>my_alternate_config.py</code>, use <code>python3 MailWebsiteChanges --config=my_alternate_config</code>.</p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<p>Requires Python 3, <a href="http://lxml.de/">lxml</a>, and <a href="http://pythonhosted.org/cssselect/">cssselect</a> (for Debian/Ubuntu, use <code>apt-get install python3</code> and <code>sudo pip-3.2 install lxml cssselect</code>).</p>
      </section>
    </div>

    
  </body>
</html>